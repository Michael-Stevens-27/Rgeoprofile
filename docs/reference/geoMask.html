<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Incorporate shapefile or raster information into a geoprofile — geoMask • Rgeoprofile*</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Incorporate shapefile or raster information into a geoprofile — geoMask" />
<meta property="og:description" content="This function allows information from a shapefile or raster to be incorporated within the geoprofile. For example, we might wish to exclude areas not on land, or weight the probabilities within a specific postcode differently. The spatial object used should be a SpatialPolygonsDataFrame as produced by the package sp or a raster." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Rgeoprofile*</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    R basics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/Install_R.html">Installing R and Rstudio</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="../articles/R_intro1.html">Introduction to R - part 1</a>
    </li>
    <li>
      <a href="../articles/R_intro2.html">Introduction to R - part 2</a>
    </li>
    <li>
      <a href="../articles/R_intro3.html">Introduction to R - part 3</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="../articles/R_exercises.html">R exercises</a>
    </li>
    <li>
      <a href="../articles/R_solutions.html">Exercise solutions</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    GP tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/Installing_RGP.html">Installing RgeoProfile</a>
    </li>
    <li>
      <a href="../articles/GP_background.html">Background</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="../articles/Basic_Rgeoprofile.html">Basic Rgeoprofile example 1</a>
    </li>
    <li>
      <a href="../articles/Data_Rgeoprofile.html">Basic Rgeoprofile example 2</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="../articles/Advanced_Rgeoprofile.html">Advanced Rgeoprofile</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Extra resources
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/General_R.html">Help with R</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="../reference/index.html">RgeoProfile function list</a>
    </li>
    <li>
      <a href="../articles/GP_resources.html">Geoprofiling resources</a>
    </li>
    <li>
      <a href="../articles/Maps_with_google.html">Maps with Google</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/Michael-Stevens-27/Rgeoprofile/tree/workshop">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Incorporate shapefile or raster information into a geoprofile</h1>
    
    <div class="hidden name"><code>geoMask.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function allows information from a shapefile or raster to be incorporated within the geoprofile. For example, we might wish to exclude areas not on land, or weight the probabilities within a specific postcode differently. The spatial object used should be a SpatialPolygonsDataFrame as produced by the package sp or a raster.</p>
    </div>

    <pre class="usage"><span class='fu'>geoMask</span><span class='op'>(</span>
  <span class='va'>probSurface</span>,
  <span class='va'>params</span>,
  <span class='va'>mask</span>,
  scaleValue <span class='op'>=</span> <span class='fl'>1</span>,
  operation <span class='op'>=</span> <span class='st'>"inside"</span>,
  maths <span class='op'>=</span> <span class='st'>"multiply"</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>probSurface</th>
      <td><p>the original geoprofile, usually the object $posteriorSurface produced by geoMCMC().</p></td>
    </tr>
    <tr>
      <th>params</th>
      <td><p>an object produced by geoParams().</p></td>
    </tr>
    <tr>
      <th>mask</th>
      <td><p>the spatial information to include. Must be one of SpatialPolygonsDataFrame, SpatialLinesDataFrame or RasterLayer.</p></td>
    </tr>
    <tr>
      <th>scaleValue</th>
      <td><p>different functions depending on value of "operation". For "inside' or "outside", the value by which probabilities should be multiplied inside or outside the shapefile. For "near" and "far", scaleValue is the importance of proximity to, or distance from, the object described in the SpatialPolygonsDataFrame, SpatialLinesDataFrame or RasterLayer. Thus, the default value of scaleValue = 1 can be increased to exaggerate the importance of proximity or distance. Not used for "continuous".</p></td>
    </tr>
    <tr>
      <th>operation</th>
      <td><p>how to combine the surface and the new spatial information. Must be one of "inside", "outside", "near", "far" or "continuous". The first two multiply areas inside or outside the area described in the shapefile (or raster) by scaleValue. "near" or "far" weight the geoprofile by its closeness to (or distance from) the area described in the shapefile (or raster). Finally, "continuous" uses a set of numerical values (e.g. altitude) to weight the geoprofile. NOTE: 'near' and 'far' can take a few minutes to run.</p></td>
    </tr>
    <tr>
      <th>maths</th>
      <td><p>one of "add", "subtract", multiply" or "divide. The mathematical operation used to combine the new spatial data with the geoprofile when operation = "continuous".</p></td>
    </tr>
    </table>


    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='co'># load London example data and set params</span>
<span class='va'>d</span> <span class='op'>&lt;-</span> <span class='va'>LondonExample_crimes</span>
<span class='va'>s</span> <span class='op'>&lt;-</span> <span class='va'>LondonExample_sources</span>
<span class='va'>p</span> <span class='op'>=</span> <span class='fu'><a href='geoParams.html'>geoParams</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>d</span>, sigma_mean <span class='op'>=</span> <span class='fl'>1</span>, sigma_squared_shape <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
<span class='co'># run model</span>
<span class='va'>m</span> <span class='op'>=</span> <span class='fu'><a href='geoMCMC.html'>geoMCMC</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>d</span>, params <span class='op'>=</span> <span class='va'>p</span><span class='op'>)</span>

<span class='co'># plot original map</span>
<span class='va'>map1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='geoPlotLeaflet.html'>geoPlotLeaflet</a></span><span class='op'>(</span>params <span class='op'>=</span> <span class='va'>p</span>, data <span class='op'>=</span> <span class='va'>d</span>, source <span class='op'>=</span> <span class='va'>s</span>, surface <span class='op'>=</span> <span class='va'>m</span><span class='op'>$</span><span class='va'>geoProfile</span><span class='op'>)</span>
<span class='va'>map1</span>

<span class='co'># mask out North London and replot</span>
<span class='va'>north_london_mask</span> <span class='op'>&lt;-</span> <span class='fu'><a href='geoShapefile.html'>geoShapefile</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='va'>prob_masked</span> <span class='op'>&lt;-</span> <span class='fu'>geoMask</span><span class='op'>(</span>probSurface <span class='op'>=</span> <span class='va'>m</span><span class='op'>$</span><span class='va'>posteriorSurface</span>, 
                       params <span class='op'>=</span> <span class='va'>p</span>, 
                       mask <span class='op'>=</span> <span class='va'>north_london_mask</span>,
                       operation <span class='op'>=</span> <span class='st'>"inside"</span>, 
                       scaleValue <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span>
<span class='va'>gp_masked</span> <span class='op'>&lt;-</span> <span class='fu'><a href='geoProfile.html'>geoProfile</a></span><span class='op'>(</span><span class='va'>prob_masked</span><span class='op'>$</span><span class='va'>prob</span><span class='op'>)</span>

<span class='co'># plot new surface</span>
<span class='va'>map2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='geoPlotLeaflet.html'>geoPlotLeaflet</a></span><span class='op'>(</span>params <span class='op'>=</span> <span class='va'>p</span>, data <span class='op'>=</span> <span class='va'>d</span>, source <span class='op'>=</span> <span class='va'>s</span>, surface <span class='op'>=</span> <span class='va'>gp_masked</span><span class='op'>)</span>
<span class='va'>map2</span>

<span class='co'># repeat, restricting mask to Tower Hamlets and using 'near' instead of 'inside'</span>
<span class='va'>TH_mask</span> <span class='op'>&lt;-</span> <span class='va'>north_london_mask</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='va'>north_london_mask</span><span class='op'>$</span><span class='va'>NAME</span> <span class='op'>==</span> <span class='st'>"Tower Hamlets"</span><span class='op'>)</span>,<span class='op'>]</span>

<span class='va'>prob_masked2</span> <span class='op'>&lt;-</span> <span class='fu'>geoMask</span><span class='op'>(</span>probSurface <span class='op'>=</span> <span class='va'>m</span><span class='op'>$</span><span class='va'>posteriorSurface</span>, 
                        params <span class='op'>=</span> <span class='va'>p</span>, 
                        mask <span class='op'>=</span> <span class='va'>TH_mask</span>, 
                        operation <span class='op'>=</span> <span class='st'>"far"</span>, 
                        scaleValue <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>

<span class='va'>gp_masked2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='geoProfile.html'>geoProfile</a></span><span class='op'>(</span><span class='va'>prob_masked2</span><span class='op'>$</span><span class='va'>prob</span><span class='op'>)</span>

<span class='co'># plot new surface</span>
<span class='va'>map3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='geoPlotLeaflet.html'>geoPlotLeaflet</a></span><span class='op'>(</span>params <span class='op'>=</span> <span class='va'>p</span>, data <span class='op'>=</span> <span class='va'>d</span>, source <span class='op'>=</span> <span class='va'>s</span>, surface <span class='op'>=</span> <span class='va'>gp_masked2</span><span class='op'>)</span>
<span class='va'>map3</span>
<span class='op'>}</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Bob Verity, Michael Stevens, Sally Faulkner, Steven Le Comber.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


