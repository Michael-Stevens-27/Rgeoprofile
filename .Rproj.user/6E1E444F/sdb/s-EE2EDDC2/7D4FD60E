{
    "collab_server" : "",
    "contents" : "\n# Rgeoprofile_deploy.R\n\n# Author: Bob Verity\n# Date: 2017-05-26\n\n# Purpose:\n# Tests and demonstrates use of RgeoProfile package.\n\n# ------------------------------------------------------------------\nlibrary(devtools)\n\n# RStudio shortcuts:\n#    cmd+shift+L     : load_all\n#    cmd+shift+D     : document (NB, option must be activated in Build Tools)\n#    cmd+shift+E     : check\n\n# check('.', args=\"--no-examples\")  # check without running examples\n\n# ------------------------------------------------------------------\n\n#set.seed(1)\n\n# define parameters and draw some data\nn <- 1e2\nsigma_mean <- 1\nsigma_var <- 1\nsigma <- sigma_mean\ntau <- 10\nalpha <- 10\n\nDPM_draws = rDPM(n, sigma=sigma, tau=tau, alpha=alpha, priorMean_longitude=-0.035, priorMean_latitude=51.52)\n\n# some options for data\n# Note that Cholera and LondonExample_crimes are already loaded by default\nsimData <- geoData(DPM_draws$longitude, DPM_draws$latitude)\n\n# some options for sources\n# Note that WaterPumps and LondonExample_sources are already loaded by default\nsimSource <- geoDataSource(DPM_draws$source_lon, DPM_draws$source_lat)\n\n# choose data and sources from options above\ndata <- LondonExample_crimes\nsource <- LondonExample_sources\n\n# set model and MCMC parameters\nparams = geoParams(data = data, sigma_mean = sigma_mean, sigma_var = NULL, sigma_squared_shape = 2, chains = 5, burnin = 1e3, samples = 1e4, longitude_cells = 200, latitude_cells = 200)\n\n# initial map of data\n# Note that geoPlotMap may occasionally fail to download map. In this case simply run again until it passes\n# Note also that plotting the map may take quite a long time\nmap1 <- geoPlotMap(params = params, data = data, source = source)\nmap1\n\n# plot prior on sigma\ngeoPlotSigma(params = params)\n\n# ------------------------------------------------------------------\n\n# run MCMC\nm = geoMCMC(data = data, params = params)\n\n# ------------------------------------------------------------------\n\n# plot prior and posterior of sigma\ngeoPlotSigma(params = params, mcmc = m)\nabline(v = sigma, col = 2)\n\n# plot allocation\ngeoPlotAllocation(mcmc = m)\n\n# plot co-allocation\ngeoPlotCoallocation(mcmc = m)\n\n# plot profile on map\nmap2 <- geoPlotMap(params = params, data = data, source = source, surface = m$geoProfile, breakPercent = seq(0,50,l=21), opacity = 0.8)\nmap2\n\n# plot zoomed in\nmap3 <- geoPlotMap(lonLimits = c(-0.06,-0.02), latLimits = c(51.52, 51.54), params = params, data = data, source = source, surface = m$geoProfile, breakPercent = seq(0,50,l=21), opacity = 0.8)\nmap3\n\n# produce perspective plot\ngeoPersp(surface = m$geoProfile, aggregate_size = 1)\n\n# get hitscores\nhs <- geoReportHitscores(params = params, source = source, surface =m$geoProfile)\nhs\n\n# produce Lorenz plot\nGini <- geoPlotLorenz(hit_scores = hs)\nGini\n\n# find centroids of data split by best grouping (placeholder for more thorough method)\ngeoModelSources(mcmc = m, data = data)\n\n# compare to geoprofile based on ring search strategy\nsurface_ring <- geoRing(params = params, data = data, source = source, mcmc = m)\ngp_ring <- geoProfile(surface = surface_ring)\n\n# map of ring search geoprofile\nmap4 <- geoPlotMap(params = params, data = data, source = source, surface = gp_ring, opacity = 1, breakPercent = seq(0,50,l=21))\nmap4\n\n# hitscores of ring search geoprofile\nhs_ring <- geoReportHitscores(params = params, source = source, surface = gp_ring)\nhs_ring\n\n# Lorenz plot based on ring hitscores\nGini <- geoPlotLorenz(hit_scores = hs_ring)\nGini\n\n# read in north London shapefile as mask\nnorth_london_mask <- geoShapefile()\n\n# mask posterior surface and geoprofile\nprob_masked <- geoMask(m$posteriorSurface, params, north_london_mask, operation=\"inside\", scaleValue=1)\ngp_masked <- geoProfile(prob_masked$prob)\n\n# plot masked map\nmap5 <- geoPlotMap(params, data=data, source=source, surface=gp_masked, opacity=0.8)\nmap5\n",
    "created" : 1523020300846.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1568405975",
    "id" : "7D4FD60E",
    "lastKnownWriteTime" : 1523613651,
    "last_content_update" : 1523613651226,
    "path" : "~/Dropbox/Bob/Work/My Programs/Geoprofiling/RgeoProfile/ignore/R scripts/Rgeoprofile_deploy.R",
    "project_path" : "ignore/R scripts/Rgeoprofile_deploy.R",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}